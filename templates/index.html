<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FairFrame - Bias Detector</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <div class="logo-icon">
                <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M22 12h-4l-3 9L9 3l-3 9H2"></path>
                </svg>
            </div>
            <h1>Fair<span class="highlight">Frame</span></h1>
            <p class="subtitle">Detect representation gaps in your image generation prompts</p>
        </div>

        <!-- Input Section -->
        <div class="card input-card">
            <label for="promptInput">Enter your prompt</label>
            <textarea
                id="promptInput"
                placeholder="e.g., Generate a picture of a researcher..."
                rows="4"
            ></textarea>

            <div class="input-footer">
                <span id="charCount" class="char-count">0 characters</span>
                <button id="analyzeBtn" class="btn-primary">Analyze Bias</button>
            </div>

            <div class="examples">
                <p class="examples-title">Try these examples:</p>
                <div class="example-buttons">
                    <button class="example-btn">Generate a picture of a researcher</button>
                    <button class="example-btn">A white male engineer</button>
                    <button class="example-btn">Show me a Black female scientist in a wheelchair</button>
                    <button class="example-btn">A software developer</button>
                </div>
            </div>
        </div>

        <!-- Loading State -->
        <div id="loadingState" class="loading-state hidden">
            <div class="spinner"></div>
            <p>Analyzing your prompt...</p>
        </div>

        <!-- Results Section -->
        <div id="resultsSection" class="hidden">
            <!-- Overall Status -->
            <div id="statusCard" class="card status-card">
                <div class="status-content">
                    <svg id="statusIcon" class="status-icon" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="10"></circle>
                        <path d="M12 8v4M12 16h.01"></path>
                    </svg>
                    <div>
                        <h2 id="statusTitle">Analysis Complete</h2>
                        <p id="statusDescription"></p>
                        <div id="gapBadges" class="gap-badges"></div>
                    </div>
                </div>
            </div>

            <!-- Detailed Scores -->
            <div class="card scores-card">
                <h3>Detailed Analysis</h3>
                <div id="scoresList" class="scores-list"></div>
            </div>

            <!-- Recommendations -->
            <div id="recommendationsCard" class="card recommendations-card hidden">
                <h3>ðŸ’¡ Recommendations</h3>
                <ul id="recommendationsList"></ul>
            </div>
        </div>

        <!-- Footer -->
        <div class="footer">
            <p>Powered by FairFrame AI â€¢ Promoting inclusive image generation</p>
        </div>
    </div>

    <script>
        const promptInput = document.getElementById('promptInput');
        const analyzeBtn = document.getElementById('analyzeBtn');
        const charCount = document.getElementById('charCount');
        const loadingState = document.getElementById('loadingState');
        const resultsSection = document.getElementById('resultsSection');
        const exampleBtns = document.querySelectorAll('.example-btn');

        // Character counter
        promptInput.addEventListener('input', () => {
            charCount.textContent = `${promptInput.value.length} characters`;
        });

        // Example buttons
        exampleBtns.forEach(btn => {
            btn.addEventListener('click', () => {
                promptInput.value = btn.textContent;
                charCount.textContent = `${btn.textContent.length} characters`;
            });
        });

        // Keyboard shortcut (Ctrl+Enter)
        promptInput.addEventListener('keydown', (e) => {
            if (e.ctrlKey && e.key === 'Enter') {
                analyzePrompt();
            }
        });

        // Analyze button
        analyzeBtn.addEventListener('click', analyzePrompt);

        async function analyzePrompt() {
            const prompt = promptInput.value.trim();

            if (!prompt) {
                alert('Please enter a prompt');
                return;
            }

            // Show loading
            analyzeBtn.disabled = true;
            analyzeBtn.textContent = 'Analyzing...';
            loadingState.classList.remove('hidden');
            resultsSection.classList.add('hidden');

            try {
                const response = await fetch('/analyze', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ prompt })
                });

                if (!response.ok) {
                    throw new Error('Analysis failed');
                }

                const result = await response.json();
                displayResults(result);

            } catch (error) {
                alert('Error analyzing prompt: ' + error.message);
                console.error('Error:', error);
            } finally {
                analyzeBtn.disabled = false;
                analyzeBtn.textContent = 'Analyze Bias';
                loadingState.classList.add('hidden');
            }
        }

        function displayResults(result) {
            const statusCard = document.getElementById('statusCard');
            const statusIcon = document.getElementById('statusIcon');
            const statusTitle = document.getElementById('statusTitle');
            const statusDescription = document.getElementById('statusDescription');
            const gapBadges = document.getElementById('gapBadges');
            const scoresList = document.getElementById('scoresList');
            const recommendationsCard = document.getElementById('recommendationsCard');
            const recommendationsList = document.getElementById('recommendationsList');

            // Clear previous results
            gapBadges.innerHTML = '';
            scoresList.innerHTML = '';
            recommendationsList.innerHTML = '';

            // Status card
            if (result.gaps.length === 0) {
                statusCard.className = 'card status-card status-safe';
                statusIcon.innerHTML = '<circle cx="12" cy="12" r="10"></circle><path d="M9 12l2 2 4-4"></path>';
                statusTitle.textContent = 'Inclusive Prompt âœ“';
                statusDescription.textContent = 'Your prompt appears to be inclusive across gender, race, and disability representation.';
            } else {
                statusCard.className = 'card status-card status-gaps';
                statusIcon.innerHTML = '<circle cx="12" cy="12" r="10"></circle><path d="M12 8v4M12 16h.01"></path>';
                statusTitle.textContent = 'Gaps Detected';
                statusDescription.textContent = `Your prompt may be missing representation in ${result.gaps.length} ${result.gaps.length === 1 ? 'area' : 'areas'}.`;

                // Gap badges
                result.gaps.forEach(gap => {
                    const badge = document.createElement('span');
                    badge.className = `gap-badge gap-${gap.toLowerCase()}`;
                    badge.textContent = `${gap} Gap`;
                    gapBadges.appendChild(badge);
                });
            }

            // Detailed scores
            const categories = ['Gender', 'Race', 'Disability', 'Age', 'Profession'];
            categories.forEach(category => {
                const score = result.scores[category];
                const isGap = score > 0.5;
                const percentage = (score * 100).toFixed(1);

                const scoreItem = document.createElement('div');
                scoreItem.className = 'score-item';
                scoreItem.innerHTML = `
                    <div class="score-header">
                        <span class="score-label">${category}</span>
                        <span class="score-value ${isGap ? 'score-gap' : 'score-safe'}">${percentage}%</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill ${isGap ? 'progress-gap' : 'progress-safe'}"
                             style="width: ${percentage}%"></div>
                    </div>
                    <p class="score-description">
                        ${isGap
                            ? `High likelihood of ${category.toLowerCase()} representation gap`
                            : `${category} appears to be specified`}
                    </p>
                `;
                scoresList.appendChild(scoreItem);
            });

            // Recommendations
            if (result.gaps.length > 0) {
                recommendationsCard.classList.remove('hidden');

                const recommendations = {
                    'Gender': 'Consider specifying gender (e.g., "female researcher", "woman scientist")',
                    'Race': 'Include racial/ethnic diversity (e.g., "Black", "Asian", "Latina", "Indigenous")',
                    'Disability': 'Add disability representation (e.g., "in a wheelchair", "with a prosthetic limb", "with low vision")',
                    'Age': 'Consider age diversity (e.g., "young", "senior", "early-career")',
                    'Profession': 'Specify professional context if needed'
                };

                result.gaps.forEach(gap => {
                    const li = document.createElement('li');
                    li.innerHTML = `<span class="bullet">â€¢</span><span>${recommendations[gap]}</span>`;
                    recommendationsList.appendChild(li);
                });
            } else {
                recommendationsCard.classList.add('hidden');
            }

            resultsSection.classList.remove('hidden');
        }
    </script>
</body>
</html>